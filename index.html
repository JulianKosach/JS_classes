<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>

	<div id="game"></div>
	
	<script>

		// Main Game constructor
		function Game(gameOptions) {
			this._gameOptions = gameOptions || {};
			this._max_players_count = gameOptions.max_players_count || 4;
			this._players_count = gameOptions.initial_players_count || 4;
			this._set_random = gameOptions.set_random || true;
			this._wrap = (this._gameOptions.wrap && document.querySelector(this._gameOptions.wrap)) || document.getElementsByTagName('body')[0];
		}

		Game.prototype.initGameField = function() {
			this._gameField = document.createElement('div');
			this._gameField.className = "game-field";
			this._wrap.append(this._gameField);
			return this;
		};

		Game.prototype.clearGameField = function() {
			this._gameField.innerHTML = "";
			return this;
		};

		Game.prototype.addButtons = function () {
			var _this = this;
			for (var i=1; i<=this._players_count; i++) {
				this._gameField.append( new Button({
					text: i,
					backgroundColor: _this['_player_field_'+i].querySelector('input').value,
					positioning: {
						left: (_this._set_random) ? Math.random()*90+"%" : !(i%2)*90+'%',
						top: (_this._set_random) ? Math.random()*90+"%" : (i>2&1)*90+'%'
					}
				}).draw() );
			}
			return this;
		};

		Game.prototype.initCreateButton = function() {
			var _this = this;
			this._createButton = document.createElement('button');
			this._createButton.innerHTML = "Create";
			this._createButton.className = "game-field__create-button";
			this._createButton.addEventListener('click', function(){
				_this.createClickHandler();
			});
			this._settingsBlock.append(_this._createButton);
			return this;
		};

		Game.prototype.createClickHandler = function() {
			this.clearGameField();
			this.addButtons();
		};

		Game.prototype.initGameSettings = function() {
			var _this = this;
			this._settingsBlock = document.createElement('div');
			this._settingsBlock.className = "game-field__settings";
			// random positioning checkbox
			var random_label = document.createElement('label');
			random_label.className = "game-field__random-label";
			random_label.innerHTML = "Random positioning";
			var checkbox = document.createElement('input');
			checkbox.className = "game-field__random-checkbox";
			checkbox.setAttribute('type', 'checkbox');
			if (_this._set_random) checkbox.setAttribute('checked', 'checked');
			checkbox.addEventListener('change', function(){
				_this._set_random = this.checked;
			});
			random_label.append(checkbox);
			this._settingsBlock.append(random_label);
			// players count select
			var select_label = document.createElement('div');
			select_label.className = "game-field__count-label";
			select_label.innerHTML = "Players count";
			var select = document.createElement('select');
			select.className = "game-field__count-select";
			for (var i=1; i<=_this._max_players_count; i++) {
				var option = document.createElement('option');
				option.innerHTML = i;
				if (i === _this._players_count) option.setAttribute('selected', 'selected');
				select.append(option);
			}
			select.addEventListener('change', function(){
				_this._players_count = this.value;
				for (var i=1; i<=_this._max_players_count; i++) {
					_this['_player_field_'+i].style.display = (i<=_this._players_count) ? 'block' : 'none';
				}
			});
			select_label.append(select);
			this._settingsBlock.append(select_label);
			// inputs for players
			for (var i=1; i<=_this._max_players_count; i++) {
				var label = document.createElement('label');
				label.innerHTML = 'Player '+i+' color - ';
				label.style.display = (i<=_this._players_count) ? 'block' : 'none';
				var color_input = document.createElement('input');
				color_input.className = "game-field__color-field";
				color_input.setAttribute('placeholder', '#777777');
				label.append(color_input);
				this['_player_field_'+i] = label;
				this._settingsBlock.append(label);
			}
			this.initCreateButton();
			this._wrap.append(this._settingsBlock);
			return this;
		};

		Game.prototype.initGame = function(){
			this.initGameField(this._gameOptions.gameFieldOptions);
			this.initGameSettings();
			console.log('Your game is inited!');
			return this;
		};





		// Main Button constructor
		function Button(buttonOptions) {
			this._buttonElement = document.createElement('button');
			this._buttonElement.className = "btn";
			this._buttonOptions = buttonOptions || {};
		}

		Button.prototype.render = function(){
			this._buttonElement.innerHTML = this._buttonOptions.text || 'Button';
			if (this._buttonOptions.positioning) {
				this._buttonElement.style.position = this._buttonOptions.positioning.position || 'absolute';
				this._buttonElement.style.left = this._buttonOptions.positioning.left || '0';
				this._buttonElement.style.top = this._buttonOptions.positioning.top || '0';
			}
			if (this._buttonOptions.backgroundColor) {
				this._buttonElement.style.backgroundColor = this._buttonOptions.backgroundColor;
			}
			return this;
		};

		Button.prototype.draw = function(){
			this.render();
			return this._buttonElement;
		};



		// Red Button constructor
		function RedButton(buttonOptions) {
			Button.apply(this, arguments);
			this._buttonElement.className = "btn btn--red";
		}
		RedButton.prototype = Object.create(Button.prototype);
		RedButton.prototype.constructor = Button;


		// Green Button constructor
		function GreenButton(buttonOptions) {
			Button.apply(this, arguments);
			this._buttonElement.className = "btn btn--green";
		}
		GreenButton.prototype = Object.create(Button.prototype);
		GreenButton.prototype.constructor = Button;


		// Blue Button constructor
		function BlueButton(buttonOptions) {
			Button.apply(this, arguments);
			this._buttonElement.className = "btn btn--blue";
		}
		BlueButton.prototype = Object.create(Button.prototype);
		BlueButton.prototype.constructor = Button;





		document.addEventListener('DOMContentLoaded', function() {
				
			var myGame = new Game({
				wrap: '#game'
			}).initGame();

		});
	</script>
</body>
</html>